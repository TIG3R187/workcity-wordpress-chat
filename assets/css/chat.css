/* ----- Workcity Chat: Color and Alignment Fixes ----- */

/* Single message - IMPORTANT CLASS STRUCTURE FIX */
.workcity-chat-message {
  padding: 8px 12px;
  border-radius: 10px;
  max-width: 78%;
  word-break: break-word;
  box-shadow: 0 1px 0 rgba(0,0,0,0.02);
  margin-bottom: 8px;
}

/* Message alignment - CRITICAL FIX */
.workcity-chat-message.my-message { 
  align-self: flex-end !important; 
  margin-left: auto !important;
}
.workcity-chat-message.their-message { 
  align-self: flex-start !important; 
  margin-right: auto !important;
}

/* Role Colors (light mode) - CRITICAL CLASS STRUCTURE FIX */
.workcity-chat-message.role-administrator,
.workcity-chat-message.role-admin { 
  background: #ffebee !important; 
  color: #7a0c0c !important; 
}
.workcity-chat-message.role-customer, 
.workcity-chat-message.role-buyer { 
  background: #e0f7fa !important; 
  color: #004d54 !important; 
}
.workcity-chat-message.role-merchant { 
  background: #fff8e6 !important; 
  color: #7a4b00 !important; 
}
.workcity-chat-message.role-designer { 
  background: #f3e5f5 !important; 
  color: #3f0067 !important; 
}
.workcity-chat-message.role-agent { 
  background: #e8f5e9 !important; 
  color: #0b5d0b !important; 
}
.workcity-chat-message.role-you { 
  background: #e8eaf6 !important; 
  color: #1a237e !important; 
}

/* Dark mode message colors - CRITICAL FIX */
html.chat-dark-mode .workcity-chat-message { 
  background: #333 !important; 
  color: #eaeaea !important; 
  border: 1px solid #444 !important;
}

/* Role colors for dark mode - CRITICAL FIX */
html.chat-dark-mode .workcity-chat-message.role-administrator,
html.chat-dark-mode .workcity-chat-message.role-admin { 
  background: #4a1212 !important; 
  color: #ffcccc !important; 
}
html.chat-dark-mode .workcity-chat-message.role-customer,
html.chat-dark-mode .workcity-chat-message.role-buyer { 
  background: #0b4a52 !important; 
  color: #e0f7fa !important; 
}
html.chat-dark-mode .workcity-chat-message.role-merchant { 
  background: #5a3e00 !important; 
  color: #fff8e6 !important; 
}
html.chat-dark-mode .workcity-chat-message.role-designer { 
  background: #3a0067 !important; 
  color: #f3e5f5 !important; 
}
html.chat-dark-mode .workcity-chat-message.role-agent { 
  background: #004d24 !important; 
  color: #e8f5e9 !important; 
}
html.chat-dark-mode .workcity-chat-message.role-you { 
  background: #1a237e !important; 
  color: #e8eaf6 !important; 
}

/* Make sure chat messages container has flex display - CRITICAL FIX */
.chat-messages {
  display: flex !important;
  flex-direction: column !important;
  gap: 8px !important;
}

/* Force dark mode styles when class is applied */
html.chat-dark-mode .workcity-chat-container { 
  background: #1a1a1a !important; 
  color: #eaeaea !important; 
}
html.chat-dark-mode .chat-messages { 
  background: #222 !important; 
}
html.chat-dark-mode .chat-input { 
  background: #333 !important; 
  color: #eaeaea !important; 
  border-color: #444 !important;
}

/* ===== Workcity Chat: layout & safer dark-mode fixes ===== */

/* 1) Force chat container to be centered and not overflow */
.workcity-chat-container {
  width: calc(100% - 48px);     /* leave some page padding */
  max-width: 720px;            /* your intended max width */
  margin: 48px auto !important;
  box-sizing: border-box;
  position: relative;
  display: block !important;
  z-index: 1;
}

/* make sure inner elements respect box-sizing */
.workcity-chat-container * { box-sizing: border-box; }

/* make the messages area safe and scrollable without shifting layout */
.chat-messages {
  width: 100%;
  min-height: 220px;
  max-height: 60vh;           /* use viewport height so it stays visible */
  overflow-y: auto;
  box-sizing: border-box;
}

/* prevent long words/urls pushing width */
.workcity-chat-message, .workcity-chat-message .text {
  word-break: break-word;
  overflow-wrap: anywhere;
}

/* If theme uses a narrow content column, allow chat container to break out visually
   (optional - only if you want chat to ignore the page column widths) */
/*
.workcity-chat-container {
  position: relative;
  left: 50%;
  transform: translateX(-50%);
  width: min(900px, calc(100% - 48px));
}
*/

/* ===== Safer dark-mode rules (replace the broad star selector) ===== */

/* DON'T use: html.chat-dark-mode * { ... }  â€” too broad. Use specific containers instead. */

/* Apply dark colors to page main wrappers and chat container */
html.chat-dark-mode,
body.chat-dark-mode,
html.chat-dark-mode .site,
html.chat-dark-mode .site-content,
html.chat-dark-mode main,
html.chat-dark-mode .entry-content,
html.chat-dark-mode .workcity-chat-container {
  background: #0f0f0f !important;
  color: #eaeaea !important;
}

/* Messages background in dark */
html.chat-dark-mode .chat-messages { background: #111 !important; }

/* Make chat container stand out on dark */
html.chat-dark-mode .workcity-chat-container {
  background: #1a1919 !important;
  border: 1px solid rgba(255,255,255,0.04) !important;
  box-shadow: 0 6px 20px rgba(0,0,0,0.5) !important;
}

/* Ensure inputs are visible in dark */
html.chat-dark-mode textarea,
html.chat-dark-mode input[type="text"],
html.chat-dark-mode .chat-file-label,
html.chat-dark-mode input[type="file"] {
  background: #2a2828 !important;
  color: #eee !important;
  border: 1px solid rgba(255,255,255,0.06) !important;
}

/* Role color overrides for dark mode (keep them readable) */
html.chat-dark-mode .role-administrator  { background:#6b2b6b !important; color:#fff !important; }
html.chat-dark-mode .role-customer, html.chat-dark-mode .role-buyer { background: #0b4a52 !important; color:#fff !important; }
html.chat-dark-mode .role-merchant       { background:#5a3e00 !important; color:#fff !important; }
html.chat-dark-mode .role-designer       { background:#3a0067 !important; color:#fff !important; }
html.chat-dark-mode .role-agent          { background:#004d24 !important; color:#fff !important; }

/* make message borders clearly visible on dark */
html.chat-dark-mode .workcity-chat-message {
  border: 1px solid rgba(255,255,255,0.04) !important;
  box-shadow: none !important;
}

/* button centered at top (dark mode toggle) should not overlap admin bar */
#chat-dark-toggle {
  top: 18px !important;
  z-index: 999999 !important;
}

/* Small responsive tweak */
@media (max-width:640px) {
  .workcity-chat-container { padding: 12px !important; width: calc(100% - 24px) !important; }
  .chat-messages { max-height: 50vh; }
}


/* ===== Workcity Chat: layout & safer dark-mode fixes ===== */

/* Force chat container to be centered and not overflow theme columns */
.workcity-chat-container {
  box-sizing: border-box;
  width: calc(100% - 48px) !important;   /* allow some page padding */
  max-width: 900px !important;           /* grow a bit wider if needed */
  margin: 48px auto !important;
  position: relative !important;
  display: block !important;
  z-index: 2 !important;
  padding: 12px !important;
}

/* Ensure children use box-sizing */
.workcity-chat-container, .workcity-chat-container * { box-sizing: border-box; }

/* Messages area: full width of the chat container, scroll safely */
.chat-messages {
  width: 100% !important;
  min-height: 220px;
  max-height: 60vh;
  overflow-y: auto;
  padding: 8px !important;
  background: var(--chat-messages-bg, #fafafa) !important;
}

/* Chat form & controls should take full width and be centered */
.chat-form, .chat-controls {
  width: 100% !important;
  display: flex !important;
  gap: 8px;
  align-items: center;
  justify-content: flex-start;
  margin-top: 12px;
}

/* Make textarea expand and align with messages */
.chat-form textarea, .chat-input, #chat-input {
  width: 100% !important;
  max-width: 100% !important;
  resize: vertical;
  min-height: 44px;
}

/* Keep messages wrapping and not stretching the page */
.workcity-chat-message, .workcity-chat-message .text {
  word-break: break-word;
  overflow-wrap: anywhere;
}

/* Make sure the role classes & my/their alignment still work */
.workcity-chat-message.my-message { align-self: flex-end !important; margin-left: auto !important; }
.workcity-chat-message.their-message { align-self: flex-start !important; margin-right: auto !important; }

/* Safer dark mode rules (specific, no global wildcard) */
html.chat-dark-mode,
body.chat-dark-mode,
html.chat-dark-mode .workcity-chat-container {
  background: #0f0f0f !important;
  color: #eaeaea !important;
}

/* Chat container on dark */
html.chat-dark-mode .workcity-chat-container {
  background: #1a1919 !important;
  border: 1px solid rgba(255,255,255,0.04) !important;
  box-shadow: 0 6px 20px rgba(0,0,0,0.5) !important;
}

/* Inputs visible in dark */
html.chat-dark-mode textarea,
html.chat-dark-mode input[type="text"],
html.chat-dark-mode .chat-file-label,
html.chat-dark-mode input[type="file"] {
  background: #2a2828 !important;
  color: #eee !important;
  border: 1px solid rgba(255,255,255,0.06) !important;
}

/* Role color overrides for dark (examples - tweak as needed) */
html.chat-dark-mode .role-administrator  { background:#6b2b6b !important; color:#fff !important; }
html.chat-dark-mode .role-customer, html.chat-dark-mode .role-buyer { background: #0b4a52 !important; color:#fff !important; }

/* Message border visibility on dark */
html.chat-dark-mode .workcity-chat-message { border: 1px solid rgba(255,255,255,0.04) !important; box-shadow: none !important; }

/* Header toggle z-index (so it sits above admin bar) */
#chat-dark-toggle { z-index: 999999 !important; top: 18px !important; }

/* Small responsive tweaks */
@media (max-width: 640px) {
  .workcity-chat-container { width: calc(100% - 24px) !important; margin: 18px auto !important; }
  .chat-messages { max-height: 50vh; }
}
